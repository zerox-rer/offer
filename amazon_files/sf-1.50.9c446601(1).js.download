(()=>{const e="sfImpression",t="LightAdImpression",i="viewablelatency",a=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),s=(a("bodyBegin","bb",e),a("bodyBegin","bb",t),a("bodyEnd","be")),r=(a("clickToATF","af"),a("criticalFeature","cf")),n=(a("criticalFeature","cf",e),a("criticalFeature","cf",t),a("loaded","ld")),o=a("loaded","ld",e),l=(a("loaded","ld",t),a("viewablelatency:bodyBegin","bb",i),a("viewablelatency:loaded","ld",i),(e,t)=>{console.error(e,t)}),d=e=>{e.sendLatencyMetric(n),e.sendLatencyMetric(r)},c=e=>"V"===e,h={1027:"Sponsored Display DRA"},m={1:"Enabled",0:"NotEnabled","-1":"Unknown"},u=e=>v(e),v=e=>decodeURIComponent(escape(atob(e))),p=e=>e&&0===Object.keys(e).length&&e.constructor===Object;let g=null,w=null,b=null,f=null,y=null;const M=new class{viewabilityStandards(){return f=f||[],f}payload(){return b=b||{},b}},x={ext:{inViewPercentage:()=>(g=g||0,Math.round(100*g)),geom:()=>(w=w||{},w)}},C={playingTime:()=>(y=y||0,y)},E=()=>M,P=()=>C,T=e=>{var t,i,a,s;g=void 0!==(null==e||null===(i=e.geom)||void 0===i||null===(t=i.self)||void 0===t?void 0:t.iv)?null==e||null===(s=e.geom)||void 0===s||null===(a=s.self)||void 0===a?void 0:a.iv:null,null===g&&delete x.ext.inViewPercentage,w=void 0!==(null==e?void 0:e.geom)?null==e?void 0:e.geom:null,null===w&&delete x.ext.geom,b=void 0!==(null==e?void 0:e.payload)?null==e?void 0:e.payload:null,null===b&&delete M.payload,f=void 0!==(null==e?void 0:e.viewabilityStandards)?null==e?void 0:e.viewabilityStandards:null,null===f&&delete M.viewabilityStandards},I="adload_renderstart",S="adload_renderend",A="impression",_="viewability",N="unservedviewability",D="adload:renderstart",k="adload:renderend",L="adload:impression",F="adload:viewability",U="adload:unservedviewability";class R{constructor(e,t){this.weblabsWindow=e,this.prefix=t,this.isT1=()=>"t1"===this.weblabTreatment(),this.isT2=()=>"t2"===this.weblabTreatment(),this.isT3=()=>"t3"===this.weblabTreatment(),this.isT4=()=>"t4"===this.weblabTreatment(),this.isT5=()=>"t5"===this.weblabTreatment(),this.weblabTreatment=()=>{var e,t,i;return null===(i=this.weblabsWindow)||void 0===i||null===(t=i.renderingWeblabs)||void 0===t||null===(e=t[this.prefix])||void 0===e?void 0:e.toLowerCase()}}}const O=()=>new R(window,"ADPT_SF_BTR_PIXEL_997225"),B=e=>{const t=null==(i=e)?void 0:i.replace("criticalFeature","").replace("windowOnLoad","").replace("spATFEvent","").replace("r2OnLoad","").replace("aboveTheFold","").replace("af","");var i;return""===t||"immediate"===t},V="btr_client",W="cod_client",$=async e=>{const t=await fetch(e,{keepalive:!0});if(t.ok)return await t.json();throw new Error(`Failed to fetch ad from ${e} due to ${t.status}`)},H="pj";class z{constructor(e,t,i){this.c=e,this.o=t,this.mL=i,this.pendingMessages=new Map,this.waitForMessageProcessed=async e=>new Promise((t=>this.pendingMessages.set(e,t))),this.receiveMessage=e=>{try{const i=e.data,a=i.command?i.command.split("."):[];let s=this.c[a[0]];for(let e=1;e<a.length&&s;e++)s=s[a[e]];if("customMessage"===i.command){const e=i.data.key,a=i.data.data;if("function"==typeof this.mL[e])try{this.mL[e](a)}catch(t){this.c.logError("Custom Message Listener Error",t)}}else s&&(s(i.data),j(i.command,this.pendingMessages))}catch(t){return void this.c.logError("Error with "+e.data.command,t)}}}}const j=(e,t)=>{const i=null==t?void 0:t.get(e);null==i||i(),null==t||t.delete(e)};var J=function(e,t){console.error(e),q("ERROR",e,G(e,t))},q=function(e,t,i){var a;null===(a=window.ueLogError)||void 0===a||a.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},G=function(e,t){return t instanceof Error?t:t?new Error(t):new Error(e)},K=new RegExp(/((&#\d{2,4};)|(&[a-z]{2};)|(&[a-z]{3,7};)|(%[a-fA-F0-9]{2})|(\W))pd_rd_plhdr(=|%3D)t((&#\d{2,4};)|(&[a-z]{2,7};)|(%[a-fA-F0-9]{2})|(\W))/),X="$1",Q="$8",Y=function(e,t){var i=t,a=e;if("&pd_rd_plhdr=t"===e||""===e.trim())return i;(a=a.replace(/&amp;/g,"&")).startsWith("&")&&(a=a.replace(/^&+/,"")),a.endsWith("&")&&(a=a.replace(/&+$/,""));try{var s=void 0,r=0;do{if(r++,!(s=i.match(K)))break;var n=s[1],o=s[8],l=s[7],d=n.startsWith("&")&&n.endsWith(";")||o.startsWith("&")&&o.endsWith(";"),c=n.startsWith("%")&&o.startsWith("%")&&"%3D"===l;i=d?i.replace(K,X+a.replace(/&/g,"&amp;")+Q):c?i.replace(K,X+encodeURIComponent(a)+Q):i.replace(K,X+a+Q)}while(s&&r<10)}catch(h){return t}return i};const Z=(e,t,i,a)=>{try{t.countMetric(D,1),t.logCsaEvent(I),a(e,i),t.countMetric(k,1),t.logCsaEvent(S)}catch(s){t.handleFallbackBehavior()}},ee="adfetch_punt",te="adfetch_error",ie="adfetch_noad",ae=(e,t)=>({async getAd(){try{e.countMetric("adfetch:request",1),e.logCsaEvent("adfetch_request");const i=await $(t);switch(null==i?void 0:i.status){case"ok":return Promise.resolve({creative:se(i.creative),creativeTemplateName:i.creativeTemplateName,instrumentationPixelUrl:i.instrPixelURL,impressionPixelUrl:i.impPixelURL});case"punt":e.countMetric(ee,1),e.logCsaEvent(ee);break;case"error":e.countMetric(te,1),e.logCsaEvent(te);break;default:e.countMetric(ie,1),e.logCsaEvent(ie)}}catch(i){e.countMetric("adfetch:httperror",1),e.logCsaEvent("adfetch_httperror"),e.logError("Couldn't fetch Ad From AAX.",i)}throw new Error("Could not fetch creative html")}}),se=e=>{try{return JSON.parse(e).creative}catch(t){return e}},re=async(e,t)=>{if(!e)throw new Error("No html content found on a server side fetch");return ne(e,t)},ne=(e,t)=>{const i=t?e:u(e);return oe(i,t),i},oe=(e,t)=>{t&&e.length!==t&&console.debug(`Mismatched expected htmlContentEncoded size. Expected ${t} but got ${e.length}`)},le=async e=>{const t=await(await fetch(e)).text();return de(t)},de=e=>{try{return JSON.parse(e).creative}catch(t){return e}},ce=(e,t)=>{if("SERVER_SIDE"===e.creative.flow)return a=e.htmlContentEncoded,s=e.htmlContentEncodedLength,{getAd:async()=>({creative:await re(a,s)})};if("XSP_CLIENT_SIDE"===e.creative.flow&&e.creative.url)return ae(t,e.creative.url);if("ORTB_CLIENT_SIDE"===e.creative.flow&&e.creative.url)return i=e.creative.url,{getAd:async()=>({creative:await le(i)})};var i,a,s;throw new Error("Wrong creative flow provided")},he=500;class me{renderFallbackStaticAdHelper(){}loadAdPlatformSpecific(e){return e}constructor(e,t,i,a,r,n){this.o=e,this.mp=t,this.mL=i,this.cms=a,this.c=r,this.setupVideoPlayer=n,this.renderCompleteTime=null,this.state={hasCODFallbackRegistered:!1,hasFiredCODPixel:!1},this.clickTrackingParam="",this.initSFClient=async(e={})=>{const{timeout:t=he}=e;var i,a;this.ensureGlobals(),Object.defineProperty(document,"cookie",{get:()=>"",set:()=>{}}),(null===(a=window)||void 0===a||null===(i=a.navigator)||void 0===i?void 0:i.geolocation)&&(window.navigator.geolocation.watchPosition=(e,t,i)=>0,window.navigator.geolocation.getCurrentPosition=()=>{}),document.write=this.documentWriteDelegate,document.open=(...e)=>{this.nativeOpen(...e),this.ensureGlobals()},this.c.sendLatencyMetric(s),this.cms.sendMessage("safeFrameReady"),this.clickTrackingParam=await ge(this.mp,t),this.mp.onmessage=this.cmr.receiveMessage,this.c.countMetric("adload:iframeinitialized",1),this.c.logCsaEvent("adload_iframeinitialized"),new R(window,"ADPT_SF_RESIZE_ASPECT_RATIO_909226").isT1()||((e,t)=>{t.disableResizeFunc||e.sendMessage("resizeSafeFrameAd"),t.resizePlacementStyle&&e.sendMessage("setResizePlacementStyle")})(this.cms,this.o),window.writeAdHandler=await this.setupWriteAdHandler(),await window.writeAdHandler(),ue(this.mL,this.cms,this.o,this.c),ve(this.o,this.c)},this.setupWriteAdHandler=async()=>{if(we(this,this.o),(null===(a=performance)||void 0===a||null===(i=a.getEntriesByType)||void 0===i||null===(t=i.call(a,"resource"))||void 0===t||null===(e=t.findIndex)||void 0===e?void 0:e.call(t,((e,t,i)=>"script"===e.initiatorType&&e.duration>2e3)))>-1)return async()=>{be(),this.c.collapseSlotInternal()};var e,t,i,a;if(pe(this.o))return async()=>{be(),this.forceRenderFallbackExperience()};try{const e=await ce(this.o,this.c).getAd(),t=e.creative;return t?(this.o.htmlContent=t,this.o.aaxInstrPixelUrl=null!==(s=e.instrumentationPixelUrl)&&void 0!==s?s:this.o.aaxInstrPixelUrl,this.o.aaxImpPixelUrl=null!==(r=e.impressionPixelUrl)&&void 0!==r?r:this.o.aaxImpPixelUrl,this.o.adCreativeMetaData.adImpressionId=this.o.aaxImpPixelUrl,this.o.adCreativeMetaData.adCreativeTemplateName=null!==(n=e.creativeTemplateName)&&void 0!==n?n:this.o.adCreativeMetaData.adCreativeTemplateName,async()=>this.loadAd(t)):async()=>{be(),this.forceRenderFallbackExperience()};var s,r,n}catch(o){return this.c.logError("Couldn't getAd from htmlProvider",o),async()=>{be(),this.forceRenderFallbackExperience()}}},this.ensureGlobals=()=>{window.onerror=this.handleErrors,window.$sf=x,window.$sfViewableInfo=E(),window.aaxInstrPixelUrl=this.o.aaxInstrPixelUrl},this.documentWriteDelegate=async e=>{await xe(e,this.state,this,this.o,this.cms,this.c.cr,this.c)},this.handleErrors=(e,t,i,a,s)=>{const r=s||new Error(e.toString());return this.c.logError("Window.onerror",r),this.renderCompleteTime||this.forceRenderFallbackExperience(),!0},this.forceRenderFallbackExperience=()=>{Me(this.c,this.o,this.cms);this.o.fallbackStaticAdImgUrl&&this.o.fallbackStaticAdClickUrl?(this.renderFallbackStaticAd(this.o.fallbackStaticAdImgUrl,this.o.fallbackStaticAdClickUrl,this.o.fallbackStaticAdExtraStyle),this.renderCompleteTime=new Date):this.c.collapseSlotInternal(),this.c.handleFallbackExperience()},this.renderFallbackStaticAd=(e,t,i)=>{const a=document.createElement("a");a.target="_top",a.href=t,a.append(((e,t)=>{const i=document.createElement("img");return i.src=e,i.id="static-fallback-img",((e,t)=>{t.split(" ").forEach((t=>{const i=t.split("=");e.setAttribute(i[0],i[1])}))})(i,t),i})(e,i)),document.body.replaceChildren(),document.body.append(a),this.renderFallbackStaticAdHelper(),this.ensureGlobals(),this.mp.onmessage=this.cmr.receiveMessage},this.loadAd=async e=>{this.o.isNoInventory=!1,Me(this.c,this.o,this.cms);let t=Y(this.clickTrackingParam,e);this.isVideo()?new R(window,"ADPT_SF_ADSP_VIDEO_833419").isT1()?Z(this.o,this.c,t,this.setupVideoPlayer):this.c.handleFallbackBehavior():(t=this.loadAdPlatformSpecific(t),await this.documentWriteDelegate(t)),await ke(t,this.o,this.cms,this.c.cr,this.c)},this.isVideo=()=>{return e=this.o.mediaType,t=this.o.adCreativeMetaData.adProgramId,c(e)&&!h.hasOwnProperty(t);var e,t},this.cmr=new z(r,e,this.mL),this.nativeWrite=document.write.bind(document),this.nativeOpen=document.open.bind(document),window.onerror=this.handleErrors}}const ue=(e,t,i,a)=>{e.initAdReporter=e=>{try{window.adReporterConfig=e;const a=document.createElement("script");var s;a.type="text/javascript",a.async=!0,a.src=null!==(s=null==e?void 0:e.adReporterClientUrl)&&void 0!==s?s:"",(document.head||document.body).appendChild(a),t.sendMessage("saveAdDetailsForAdReporter",i)}catch(r){a.logError("Error appending adReporterClient script",r)}}},ve=(e,t)=>{try{const t=null==e?void 0:e.blankAdsConfig;if(new R(window,"ADPT_SF_ENABLE_BLANKADS_DETECTION_990833").isT1()){const e=document.createElement("script");e.type="text/javascript",e.src=t.blankAdsScriptUrl,(document.head||document.body).appendChild(e)}}catch(i){t.logError("Error appending blankAdScript",i)}},pe=e=>!!("true"!==e.abpAcceptable&&e.abpStatus&&e.enableFallbackForAbpStatuses&&e.enableFallbackForAbpStatuses.indexOf(m[e.abpStatus])>-1),ge=async(e,t=he)=>new Promise((i=>{let a=-1;const s=e=>{const t=e.data,s="percolateClickTracking";if(t.command!==s)throw new Error(`Unexpected command ${t}, Expected ${s}`);window.clearTimeout(a),i(t.data)};a=window.setTimeout((()=>{var a;e.removeEventListener("message",s),i(""),a=`Did not receive percolateClickTracking within ${t}ms`,console.debug(a)}),t),e.addEventListener("message",s,{once:!0}),e.start()})),we=(e,t)=>{t.creativeSupportsTTIMeasurement||window.addEventListener("load",(()=>d(e.c)),{once:!0}),window.addEventListener("load",(()=>e.c.fireViewableLatencyMetrics()),{once:!0})},be=()=>{window.dispatchEvent(new Event("load"))},fe=e=>{var t;return null===(t=document.getElementById(Pe))||void 0===t?void 0:t.setAttribute(e,"true")},ye=e=>e?e.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Me=(e,t,i)=>{if(t&&t.adCreativeMetaData&&0!==Object.keys(t.adCreativeMetaData).length){const a=ye(t.adCreativeMetaData.adCreativeTemplateName);e.addCsmTag("adrender"),e.addCsmTag("adrender:safeframe"),e.addCsmTag("adrender","creativetemplatename:"+a),i.sendMessage("addCsaEntity",{adrender:"true",creativeTemplateName:a,isLightAds:"false"}),t.adCreativeMetaData.adCreativeId&&(e.addCsmTag("adrender","creativeid:"+t.adCreativeMetaData.adCreativeId),i.sendMessage("addCsaEntity",{creativeId:t.adCreativeMetaData.adCreativeId})),t.adCreativeMetaData.adProgramId&&(e.addCsmTag("adrender","programid:"+t.adCreativeMetaData.adProgramId),i.sendMessage("addCsaEntity",{adProgramId:t.adCreativeMetaData.adProgramId})),void 0!==t.isCardsFlow&&i.sendMessage("addCsaEntity",{isCardsFlow:t.isCardsFlow.toString()})}else e.addCsmTag("noadrender"),i.sendMessage("addCsaEntity",{adrender:"false"})},xe=async(e,t,i,a,s,r,n)=>{O().isT1()?t.hasFiredCODPixel||(null!==a.firePixelsAfter&&B(a.firePixelsAfter)?r.fireImpressionPixel(W,!1):s.sendMessage("fireImpressionWithDelay"),t.hasFiredCODPixel=!0):t.hasCODFallbackRegistered||a.firePixelsAfter||(s.sendMessage("registerCODFallback",Ye(a.aaxImpPixelUrl,H,W)),t.hasCODFallbackRegistered=!0),await Ce(e,i,n)},Ce=async(e,t,i)=>{i.countMetric(D,1),i.logCsaEvent(I),i.sendAdBarTrace("renderHtmlContentStart",{readyState:document.readyState});const a=new Promise(((e,t)=>{const i=document.getElementById(Pe);if("true"===(null==i?void 0:i.getAttribute(Ee)))e();else{document.addEventListener(Te,(()=>{fe(Ee),e()}),{once:!0});const a=5e3;setTimeout((()=>{"true"!==(null==i?void 0:i.getAttribute(Ee))&&t(new Error(`Creative script replay not detected within ${a} timeout`))}),a)}}));if(null!==document.currentScript){let t=document.currentScript;for(t.insertAdjacentHTML("afterend",e),t=t.nextElementSibling;null!==t;)"SCRIPT"===t.tagName?Ae(t):Ne(t),t=t.nextElementSibling}else _e(e),Se(),Ne(document.documentElement);t.ensureGlobals(),await a,await async function(){const e=document.querySelectorAll("img"),t=Array.from(e).filter(De).map((e=>new Promise((t=>{e.addEventListener("load",(()=>{t()}),{once:!0})}))));await Promise.all(t)}(),t.renderCompleteTime=new Date,i.countMetric(k,1),i.logCsaEvent(S),i.sendAdBarTrace("renderHtmlContentEnd",{readyState:document.readyState})},Ee="iscomplete",Pe="creativeReplayStatus",Te="creativeReplayComplete",Ie=`document.dispatchEvent(new CustomEvent("${Te}"));`,Se=()=>{document.body.innerHTML+=`<script id="${Pe}">${Ie}<\/script>`},Ae=e=>{var t,i;const a=document.createRange();a.selectNode(e);const s=a.createContextualFragment(e.outerHTML).firstElementChild;if(s.getAttribute("src"))s.async=!1;else{const t=e.innerHTML;s.async=!1,s.setAttribute("src",`data:text/javascript;charset=UTF-8,${encodeURIComponent(t)}`)}null===(t=e.parentNode)||void 0===t||t.insertBefore(s,e.nextSibling),null===(i=e.parentNode)||void 0===i||i.removeChild(e)},_e=e=>{if(null==document.documentElement){const e=document.createElement("html");document.appendChild(e)}document.documentElement.innerHTML=e},Ne=e=>{const t=e.querySelectorAll("script");for(const i of t)Ae(i)},De=e=>{!e.complete||(e=>e.naturalWidth>0||e.naturalHeight>0)(e)||(e=>{0===e.height||e.width})(e)};const ke=async(e,t,i,a,s)=>{Fe(),Le();const r=await tt(e);O().isT1()?i.sendMessage("startBTRPixelTracking",{isNoInventory:!1,measurementMethod:r}):i.sendMessage("startPixelTracking",{isNoInventory:!1,measurementMethod:r}),t.adCreativeMetaData&&a.fireImageLoaded(t.adCreativeMetaData.adCreativeTemplateName),s.countMetric("adload:creativewritten",1),s.logCsaEvent("adload_creativewritten"),Ue()},Le=()=>{fe("creativeLoad"),be()},Fe=()=>{fe("creativedomcontentloaded"),document.dispatchEvent(new Event("DOMContentLoaded"))},Ue=()=>{document.addEventListener("touchstart",{handleEvent:()=>{}},!1)};var Re=function(e,t,i){if(""===t)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));var a=new URL(e),s=a.searchParams.get(t),r=s||"{}",n=JSON.parse(r),o=Object.assign(n,i);return a.searchParams.set(t,JSON.stringify(o)),a.toString()};const Oe=(e,t,i)=>{let a=e+t;return i&&(a+="_"+i),a},Be=async(e,{pixelUrl:t,id:i,baseCounterName:a,baseMetricName:s,counterExtension:r},n)=>{try{return!(e=>!!document.getElementById(e))(i)&&(e.logCsaEvent(Oe(s,"fired",r)),e.countMetric(Oe(a,"fired",r),1),e.sendAdBarTrace("pixels",{fired:{pixelUrl:t,additionalTrace:n}}),await fetch(t,{keepalive:!0,mode:"no-cors",priority:"low"}),document.getElementsByTagName("body")[0].appendChild(((e,t)=>{const i=document.createElement("img");return i.id=e,i.style.display="none",i.setAttribute("pixel-url",t),i})(i,t)),e.countMetric(Oe(a,"loaded",r),1),e.logCsaEvent(Oe(s,"loaded",r)),e.sendAdBarTrace("pixels",{loaded:{pixelUrl:t,additionalTrace:n}}),!0)}catch(o){throw e.countMetric(Oe(a,"error",r),1),e.logCsaEvent(Oe(s,"error",r)),e.sendAdBarTrace("pixels",{error:{pixelUrl:t,additionalTrace:n}}),e.logError(`Error firing pixels: ${t}`,o),o}},Ve=(e,t,i)=>e+t+JSON.stringify(i),We="impressionFired",$e="btr:impression",He="viewable",ze="not_viewable";class je{constructor(){this._viewableStartTimeInMilliseconds=void 0,this._currentState=ze,this._isCurrentlyInNotViewableState=()=>this._currentState===ze,this.transitionToViewableState=e=>{this._isCurrentlyInNotViewableState()&&(this._viewableStartTimeInMilliseconds=e),this._currentState=He},this.transitionToNotViewableState=()=>{this._currentState=ze},this.getViewableTimeInSeconds=e=>this._isCurrentlyInNotViewableState()||void 0===this._viewableStartTimeInMilliseconds?0:(e-this._viewableStartTimeInMilliseconds)/1e3}}var Je=function(e){return e.complete&&e.naturalHeight>0&&e.naturalWidth>0},qe=function(e){return 1===e.naturalHeight&&1===e.naturalWidth},Ge=function(e){var t=e.getElementsByClassName("mrc-btr-creative"),i=t.length>0;if(i){var a=function(e){for(var t=[],i=0,a=0,s=0;s<e.length;s++){var r=e[s];r instanceof HTMLImageElement&&(Je(r)?(t.push({src:r.src,isLoaded:!0}),a++):(t.push({src:r.src,isLoaded:!1}),i++))}return{isBTRCompliant:a>0&&0===i,imagesData:t}}(t);return{isBTRTaggedCreative:i,isBTRCompliant:a.isBTRCompliant,imagesData:a.imagesData}}var s=function(e){for(var t=[],i=0,a=0,s=0;s<e.length;s++){var r=e[s];r instanceof HTMLImageElement&&(Je(r)?qe(r)||(t.push({src:r.src,isLoaded:!0}),i++):(t.push({src:r.src,isLoaded:!1}),a++))}return{isBTRCompliant:i>0&&0===a,imagesData:t}}(e.getElementsByTagName("img"));return{isBTRTaggedCreative:i,isBTRCompliant:s.isBTRCompliant,imagesData:s.imagesData}};const Ke=e=>"Image"===e||"Image - mobile O&O"===e||"Standard Display"===e;class Xe{emitImpressionPixelMetrics(e){const t=this.o.adCreativeMetaData.adProgramId?this.o.adCreativeMetaData.adProgramId:"unknown",i=this.o.adCreativeMetaData.adCreativeTemplateName,a=ye(i);if(this.c.countMetric(We,1,!0),this.c.countMetric(We+":program:"+t,1,!0),this.c.countMetric(We+":template:"+a,1,!0),O().isT1()){const i=e?$e:"cod:impression";this.c.countMetric(i,1,!1),this.c.countMetric(i,1,!0),this.c.countMetric(i+":program:"+t,1,!0),this.c.countMetric(i+":template:"+a,1,!0)}else e&&(this.c.countMetric($e,1,!1),this.c.countMetric($e,1,!0),this.c.countMetric($e+":program:"+t,1,!0),this.c.countMetric($e+":template:"+a,1,!0))}constructor(e,t){this.c=e,this.o=t,this.viewedPixels={},this._viewableTimeCalculators={},this.hasLoaded=!1,this.fireImageLoaded=e=>{if(!this.hasLoaded&&Ke(e)){var t;const e=null===(t=document.getElementsByClassName("ad-background-image"))||void 0===t?void 0:t[0];if(e&&"IMG"===e.tagName)if(e.complete)this.c.countMetric("imageLoaded",1,!0),this.c.countMetric("imageLoaded:adid:"+this.o.adCreativeMetaData.adId,1,!0),this.hasLoaded=!0;else{var i;const t=null===(i=e.onload)||void 0===i?void 0:i.bind(window);e.onload=e=>{t&&t(e),this.c.countMetric("imageLoaded",1,!0),this.c.countMetric("imageLoaded:adid:"+this.o.adCreativeMetaData.adId,1,!0),this.hasLoaded=!0}}}},this.fireImpressionPixel=async(e,t)=>{t&&await Be(this.c,{id:"ape_ni_impression",pixelUrl:Ve(this.o.aaxInstrPixelUrl,"nii/",{ni:!0}),baseCounterName:"adload:unservedimpression",baseMetricName:"unservedimpression"});let i=!1;const a=e===V;if(O().isT1())if(a){if(["1002","1004","0"].includes(this.o.adCreativeMetaData.adProgramId)){if(!this.o.btrPixelUrl)return void J("No btrPixelUrl for btr eligible creative");i=await Be(this.c,{id:"ape_btr_impression",pixelUrl:Ye(Ze(this.o.btrPixelUrl),"c",V),baseCounterName:L,baseMetricName:A})}}else i=await Be(this.c,{id:"ape_impression",pixelUrl:Ye(this.o.aaxImpPixelUrl,H,W),baseCounterName:L,baseMetricName:A});else i=await Be(this.c,{id:"ape_impression",pixelUrl:Ye(this.o.aaxImpPixelUrl,H,e),baseCounterName:L,baseMetricName:A});i&&this.emitImpressionPixelMetrics(a)},this.fireMeasurabilityPixel=e=>{if(p(this.o)||p(this.c)||!this.o.aaxInstrPixelUrl)return;const t="ape_measurability";this.viewedPixels[t]||(Be(this.c,{id:t,pixelUrl:Ve(this.o.aaxInstrPixelUrl,"atf/",{atf:e.atf}),baseCounterName:"adload:measurability",baseMetricName:"measurability"}),this.viewedPixels[t]={})},this.fireViewablePixelsForVideo=(e,t,i,a,s)=>{if(p(this.o)||p(this.c)||!this.o.aaxInstrPixelUrl||!i)return;const r=i=>{var s,r;t.v=i;const n=null===(s=this.o.computed)||void 0===s?void 0:s.aPageStart,o=null===(r=this.o.computed)||void 0===r?void 0:r.adStartTime;t.ptv=n?(Date.now()-n)/1e3:0,t.ttv=o?(Date.now()-o)/1e3:0,a&&(t.niv=!0);const l={viewableInfo:t,aaxInstrPixelUrl:this.o.aaxInstrPixelUrl,viewablePercentage:e};let d;a?(d=Ve(this.o.aaxInstrPixelUrl,"niv/",t),Be(this.c,{id:"ape_ni_viewability_"+i.def,pixelUrl:d,baseCounterName:U,baseMetricName:N,counterExtension:i.def},l)):(d=Ve(this.o.aaxInstrPixelUrl,"v/",t),Be(this.c,{id:"ape_viewability_"+i.def,pixelUrl:d,baseCounterName:F,baseMetricName:_,counterExtension:i.def},l))},n=(e,t)=>{const i=e.def;t&&Qe(t,e.p)?this._viewableTimeCalculators[i].transitionToViewableState(Date.now()):this._viewableTimeCalculators[i].transitionToNotViewableState();const a=this._viewableTimeCalculators[i].getViewableTimeInSeconds(Date.now()),n=!this.viewedPixels[i].viewed&&((e,t,i)=>{const a=e>=i.t,s=t&&t>=i.t;return a&&s})(a,s,e);n&&(this.viewedPixels[i].viewed=!0,r(e))};for(let o=0;o<i.length;o++){const e=i[o].def;e&&(this.viewedPixels[e]=this.viewedPixels[e]||{},this.viewedPixels[e].viewed=void 0!==this.viewedPixels[e].viewed&&this.viewedPixels[e].viewed,void 0===this._viewableTimeCalculators[e]&&(this._viewableTimeCalculators[e]=new je))}for(let o=0;o<i.length;o++)n(i[o],e)},this.fireViewablePixels=(e,t,i,a)=>{const s=i=>{var s,r;t.v=i;const n=null===(s=this.o.computed)||void 0===s?void 0:s.aPageStart,o=null===(r=this.o.computed)||void 0===r?void 0:r.adStartTime;t.ptv=n?(Date.now()-n)/1e3:0,t.ttv=o?(Date.now()-o)/1e3:0,a&&(t.niv=!0);const l={viewableInfo:t,aaxInstrPixelUrl:this.o.aaxInstrPixelUrl,viewablePercentage:e};let d;a?(d=Ve(this.o.aaxInstrPixelUrl,"niv/",t),Be(this.c,{id:"ape_ni_viewability_"+i.def,pixelUrl:d,baseCounterName:U,baseMetricName:N,counterExtension:i.def},l)):(d=Ve(this.o.aaxInstrPixelUrl,"v/",t),Be(this.c,{id:"ape_viewability_"+i.def,pixelUrl:d,baseCounterName:F,baseMetricName:_,counterExtension:i.def},l))},r=t=>{const i=t.p,a=t.t,r=t.def;!this.viewedPixels[r].viewed&&e&&Qe(e,i)?this.viewedPixels[r].timeout||(this.viewedPixels[r].timeout=setTimeout((()=>{this.viewedPixels[r].viewed=!0,s(t)}),1e3*a)):this.viewedPixels[r].timeout&&(clearTimeout(this.viewedPixels[r].timeout),this.viewedPixels[r].timeout=null)};for(const o of i){var n;const e=o.def;(null===(n=this.viewedPixels)||void 0===n?void 0:n[e])||(this.viewedPixels[e]={viewed:!1,timeout:null}),r(o)}}}}const Qe=(e,t)=>100*e>=t&&0!==t||100*e>t&&0===t,Ye=(e,t,i)=>Re(e,t,{measurementMethod:i}),Ze=e=>e.replace(/&c=\${AAX_PAYLOAD}/,""),et=()=>{var e;return(document,e=document.body,Ge(e)).isBTRCompliant?"btr_client":"cod_client"},tt=async e=>{if(e.includes("mrc-btr-creative")){if("btr_client"===et())return Promise.resolve("btr_client");const e=new Promise((e=>{const t=new MutationObserver(((t,i)=>{for(const a of t){const t=a.target;(null==t?void 0:t.complete)&&(null==t?void 0:t.naturalHeight)>0&&(null==t?void 0:t.naturalWidth)>0&&(i.disconnect(),e())}}));t.observe(document.body,{subtree:!0,childList:!0,attributeFilter:["complete","naturalWidth","naturalHeight"]}),setTimeout((()=>{e(),t.disconnect()}),75)}));return await e,Promise.resolve(et())}return Promise.resolve(et())};class it{constructor(e,t,i,a){this.cms=e,this.o=t,this.mL=i,this.renderFallbackExperience=a,this.expandAdSlot=e=>{this.cms.sendMessage("expandAdSlot",e)},this.expandAdSlotWithOverlap=e=>{this.cms.sendMessage("expandAdSlotWithOverlap",e)},this.resetSlotSize=()=>{this.cms.sendMessage("resetSlotSize")},this.fireImpression=async e=>{this.sendLatencyMetric(o),await this.cr.fireImpressionPixel(e.measurementMethod,e.isNoInventory),this.cms.sendMessage("clearCODFallback")},this.sendAdBarTrace=(e,t)=>{this.cms.sendMessage("sendAdBarTrace",{field:e,traceInfo:t})},this.changeSize=(e,t)=>{this.cms.sendMessage("changeSize",{width:e,height:t})},this.logCsaEvent=e=>{this.cms.sendMessage("logCsaEvent",{metricName:e})},this.addCsaEntity=e=>{this.cms.sendMessage("addEntity",e)},this.registerCustomMessageListener=(e,t)=>{this.mL[e]=t},this.sendLatencyMetric=e=>{this.cms.sendMessage("sendLatencyMetric",{latencyMetricType:e,timestamp:new Date})},this.countMetric=(e,t,i)=>{this.cms.sendMessage("countMetric",{metricMsg:e,value:t,isGlobal:!!i})},this.addCsmTag=(e,t,i)=>{this.cms.sendMessage("addCsmTag",{tag:e,msg:t,isGlobal:i})},this.fireViewableLatencyMetrics=()=>{this.cms.sendMessage("fireViewableLatencyMetrics",{adLoadedTimestamp:Date.now()})},this.feedbackLabelRendered=()=>{this.cms.sendMessage("feedbackLabelRendered")},this.feedbackOpenModal=()=>{this.cms.sendMessage("feedbackOpenModal")},this.customMessage=(e,t)=>{this.cms.sendMessage("customMessage",{key:e,body:t})},this.updateViewability=e=>{var t,i,a,s,r,n,o;const l=E();if(T(e),!this.o.aaxInstrPixelUrl||!l.payload||!l.viewabilityStandards)return;this.o.isNoInventory||void 0===e.atf||this.cr.fireMeasurabilityPixel(e);const d=(null===(a=window)||void 0===a||null===(i=a.$sf)||void 0===i||null===(t=i.ext)||void 0===t?void 0:t.geom)&&(null===(r=window)||void 0===r||null===(s=r.$sf)||void 0===s?void 0:s.ext.geom()),h=(null==d||null===(n=d.self)||void 0===n?void 0:n.iv)?null==d||null===(o=d.self)||void 0===o?void 0:o.iv:null;if(c(this.o.mediaType)){const e=P();this.cr.fireViewablePixelsForVideo(h,l.payload(),l.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}else this.cr.fireViewablePixels(h,l.payload(),l.viewabilityStandards(),!!this.o.isNoInventory)},this.updatePlayingTimeForVideo=e=>{var t,i,a,s;const r=E();y=e,null===y&&delete C.playingTime;const n=(null===(a=window)||void 0===a||null===(i=a.$sf)||void 0===i||null===(t=i.ext)||void 0===t?void 0:t.geom)&&window.$sf.ext.geom(),o=null==n||null===(s=n.self)||void 0===s?void 0:s.iv;if(o&&r.payload&&r.viewabilityStandards){const e=P();this.cr.fireViewablePixelsForVideo(o,r.payload(),r.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}},this.requestVideoAutoplay=()=>{this.cms.sendMessage("requestVideoAutoplay")},this.releaseVideoAutoplay=()=>{this.cms.sendMessage("releaseVideoAutoplay")},this.haveVideoAutoplayPermission=()=>{this.cms.sendMessage("haveVideoAutoplayPermission")},this.isOnAmazon=()=>!0,this.collapseSlotInternal=()=>{this.logAPIInvocation("collapseSlot"),this.cms.sendMessage("collapseSlot")},this.logError=(e,t,i)=>{this.cms.sendMessage("logError",{message:e,error:t,level:i})},this.collapseSlot=()=>{this.handleFallbackBehavior()},this.handleFallbackBehavior=()=>{this.logAPIInvocation("handleFallbackBehavior"),this.renderFallbackExperience()},this.handleFallbackExperience=()=>{this.cms.sendMessage("handleFallbackExperience")},this.resizeCreativeWrapper=e=>{const t=window.document.getElementById(`ape_${this.o.scope}_creativeWrapper`);null!==t&&(t.style.height=e.height,t.style.width=e.width)},this.triggerEventInIframe=e=>{window.dispatchEvent(new Event("outerpage"+e.eventType))},this.logAPIInvocation=(e,...t)=>{this.cms.sendMessage("logAPIInvocation",{apiName:e,apiParams:t}),this.cms.sendMessage("logCsaEvent",{metricName:"messenger_"+e})},this.setupComputedAdDetails=e=>{this.o.computed=e.computed},this.signalAdLoadedAndInteractive=()=>{d(this)},this.cr=new Xe(this,t)}}class at{constructor(e,t){this.o=e,this.messagePort=t,this.sendMessage=(e,t)=>{const i={command:e,arid:null===this||void 0===this?void 0:this.o.arid,data:t||{}};try{this.messagePort.postMessage(i)}catch(a){l("Post Message error",a)}}}}class st extends it{constructor(e,t,i,a){super(e,t,i,a),this.isSupported=()=>!0,this.getARID=()=>this.o.arid,this.getDebugInfo=e=>{this.logAPIInvocation("getDebugInfo");const t=(i=this.o.slotName,(null===(a=window)||void 0===a?void 0:a.aanResponse)||(window.document.aanResponse?null===(s=window.document)||void 0===s?void 0:s.aanResponse[i+"adData"]:void 0));var i,a,s;const r={slot:this.o.placementName,slotName:this.o.slotName,shazamId:null==t?void 0:t.shazamId,creativeId:null==t?void 0:t.creativeId,adId:null==t?void 0:t.adId,src:this.o.creative.url,iframeHtml:window.document.body.innerHTML||""};this.customMessage(e.key,r)},this.sendAdInfo=e=>{e&&this.o.adCreativeMetaData&&(this.o.adCreativeMetaData=e)},this.getPlacementInfo=()=>(this.logAPIInvocation("getPlacementInfo"),{slot:this.o.placementName,slotName:this.o.slotName,pageType:this.o.pageType})}}class rt extends me{constructor(e,t,i){const a=new at(e,t),s={};super(e,t,s,a,new st(a,e,s,(()=>this.forceRenderFallbackExperience())),i)}}const nt="sf iframe ready",ot=async(e,t,i)=>{try{var a,s;window.dcmads=window.dcmads||{},window.dcmads.eids="4|40004007";const o=i;if(o.forcePunt)return;var r;window.renderingWeblabs=JSON.parse(null!==(r=o.weblabTreatments)&&void 0!==r?r:""),null===(s=performance)||void 0===s||null===(a=s.mark)||void 0===a||a.call(s,"SafeFrame: SF received ad details");const l=e(t,o);try{l.initSFClient()}catch(n){l.c.logError("Could not init SafeFrame Client",n)}}catch(n){l("Could not init ",n)}},lt=e=>{var t,i;null===(i=performance)||void 0===i||null===(t=i.mark)||void 0===t||t.call(i,`SafeFrame: Start Send Ready ${e}`);try{window.parent.dispatchEvent(new MessageEvent("message",{source:window,origin:window.location.origin,ports:[e],data:nt}))}catch(a){window.parent.postMessage(nt,"*",[e])}},dt=()=>""!==window.name?JSON.parse(window.name):null;var ct,ht;null===(ht=performance)||void 0===ht||null===(ct=ht.mark)||void 0===ct||ct.call(ht,"SafeFrame: Enter sf.ts"),window.SFClient||(e=>{const t=dt();if(t){const i=new MessageChannel;ot(e,i.port1,t),lt(i.port2)}else J("Ad Details not found in name!")})(((e,t,i)=>{const a=new rt(t,e,i);return window.SFClient=a.c,a}))})();
//# sourceMappingURL=sf-1.50.9c446601.js.map
